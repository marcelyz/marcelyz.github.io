---
layout: post
title:  "data"
author: "_marcelyz"
---

## 一、sql相关
- 问：数据库引擎在执行sql语句时有哪些优化策略(Rule Based Optimizer)<br/>
答：RBO 规则优化中 包含 谓词下推、Join 优化、列裁剪，分区裁剪等等。

- 问：分区裁剪主要解决什么问题<br/>
答：分区剪裁就是对于分区表或者分区索引来说，优化器可以自动从 from 和 where 中根据分区键直接提取出需要访问的分区，从而避免扫描所有的分区，降低了 IO 请求。分区剪裁可以细分为静态分区剪裁和动态分区剪裁，其中静态分区剪裁发生在 sql 语句编译阶段，而动态分区剪裁则发生在 sql 语句执行阶段，对于分区键是常量值优化器在会走静态分区剪裁的，如果分区键是变量形式优化器只会走动态分区剪裁。

- 问：hdfs写数据过程，写的过程中有哪些故障，分别会怎么处理？<br/>
答：首先client创建文件输出流对象，并与NameNode进行一次RPC远程调用，返回每个块需要的DataNode地址信息。然后将数据包以流式传输的方式分配给DataNode，最后在client端调用close方法完成数据写入，并使用complete方法通知NameNode文件写入成功，并将相关信息写入到editlog中。
一般有可能在DataNode写入的时候出现故障，这个时候会存储一个标识，回传给NameNode，方便在恢复后删除出问题的数据块。

- 问：hdfs的数据一致性和租约管理<br/>
答：采用数据校验和checksum机制，收到数据后进行校验，保证一致性。每一个客户端比如获得namenode发放的一个租约，才能进行写入，有效防止多人写入一个文件的情况。

- 问：说下raft、zab和paxos<br/>
答：这三者都是分布式系统的共识算法，Raft相对比较好理解，分为3个子问题，领袖选择(Leader Election)；记录复写(Log Replication)；安全性(Safety)。

- 问：mysql索引相关，B+树，聚簇索引等，回表<br/>
答：索引是一种数据结构，用户帮助我们在大量数据中快速定位到目标数据。以InnoDB存储引擎为例，索引一般基于B+树实现，它是存储引擎能够快速定位记录的秘密武器。
B+树索引分为聚簇索引和非聚簇索引，聚簇索引是指按照表中主键顺序构建的一颗B+树，并在叶节点中存放表中的行记录数据。非聚簇索引是指按照表中索引列顺序构建的一颗B+树，但其叶子节点只存储用户查找对应行记录的书签(主键)。一张表一定包含一个由聚集索引构成的B+树以及若干辅助索引(非聚簇索引)构成的B+树。B+树在查找对应的记录时，并不会直接从树中找出对应的行记录，它只能获取记录所在的页，将整个页加载到内存中，再通过一些稀疏索引和属性取出对应的值。
回表：非聚簇索引的叶子节点不存储表中的数据，而是存储该列对应的主键，想要查找数据还需要根据主键再去聚簇索引中进行查找，这个过程成为回表。
