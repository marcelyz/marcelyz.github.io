---
layout: post
title:  "mysql与答"
author: "marcelyz"
---

- 问：mysql索引相关，B+树，聚簇索引等，回表<br/>
答：索引是一种数据结构，用于帮助我们在大量数据中快速定位到目标数据。以InnoDB存储引擎为例，索引一般基于B+树实现，它是存储引擎能够快速定位记录的秘密武器。
    * B+树索引分为聚簇索引和非聚簇索引，聚簇索引是指按照表中主键顺序构建的一颗B+树，不能为null且必须保证唯一性，并在叶节点中存放表中的行记录数据。非聚簇索引是指按照表中索引列顺序构建的一颗B+树，但其叶子节点只存储用户查找对应行记录的书签(主键)。一张表一定包含一个由聚集索引构成的B+树以及若干辅助索引(非聚簇索引)构成的B+树。B+树在查找对应的记录时，并不会直接从树中找出对应的行记录，它只能获取记录所在的页，将整个页加载到内存中，再通过一些稀疏索引和属性取出对应的值。
    * 回表：非聚簇索引的叶子节点不存储表中的数据，而是存储该列对应的主键，想要查找数据还需要根据主键再去聚簇索引中进行查找，这个过程称为回表。  

- 问：最左前缀匹配原则<br>
答：在MySQL建立联合索引时会遵守最左前缀匹配原则，即最左优先，在检索数据时从联合索引的最左边开始匹配，任何连续的索引都能匹配上，且优化器会自动调整索引顺序，保证执行效率最高。不过联合索引遇到范围查询时会停止匹配，从索引中的第一个数据一个个的查找到最后一个索引数据，直到找到为止。
    * 优点：减少开销，覆盖索引，效率高。建立一个联合索引，相当于建了多个索引，减少了写开销。而且当联合索引覆盖了查询字段时，直接读取索引数据即可满足需求，不需要回表，性能提升特别大。  

- 问：mysql索引分类<br>
    * 根据底层数据结构划分：hash索引、B+树索引
    * 根据索引字段个数划分：单列索引、联合索引
    * 根据叶子节点数据划分：聚簇索引、辅助索引  

- 问：mysql常见log  
    * bin log: 二进制日志，属于逻辑日志(sql语句)，由server层管理，记录数据库执行的写入性操作(不包括查询)信息，以追加的形式保存在磁盘，适用场景是主从复制和数据恢复。
    * redo log: 重做日志，属于物理日志(物理数据页面的修改信息)，由InnoDB管理，也是追加写，不过当对应事务的脏页写入磁盘后，redo日志的空间就可以重用(循环写)；适用场景是确保事务的持久性，用于崩溃恢复，防止有脏页(内存数据正确，但磁盘数据未更新，此时磁盘对应的页)未写入磁盘，导致数据不一致。
    * undo log: 回滚日志，属于逻辑日志(sql语句)，由InnoDB管理，记录数据的逻辑变化(比如一条insert语句对应一条delete语句，一条update语句对应一条相反的undate语句)。使用场景是保证事务的原子性(要么全部成功，要么全部失败)，当发生错误时，回滚到事务之前的状态，同时undo log也是MVCC实现的关键。
    * slow log: 慢查询日志  
    * error log: 错误日志  
    * 总结：redolog用来保证崩溃恢复，binlog保证可以将数据库状态恢复到任一时刻，undolog保证事务回滚的能力和MVCC多版本并发控制。